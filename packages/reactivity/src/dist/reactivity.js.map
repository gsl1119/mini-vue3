{
  "version": 3,
  "sources": ["../effect.ts", "../../../shared/src/index.ts", "../baseHandler.ts", "../reactive.ts"],
  "sourcesContent": ["export let activeEffect = undefined;\r\nclass ReactiveEffect {\r\n    parent = undefined;\r\n    constructor(public fn) {}\r\n    deps = []; // effect\u4E2D\u836F\u8BB0\u5F55\u54EA\u4E9B\u5C5E\u6027\u5B9E\u5728effect\u4E2D\u4F7F\u7528\u7684\r\n    run() {\r\n        try {\r\n            this.parent = activeEffect;\r\n            activeEffect = this;\r\n            // \u5F53\u8FD0\u884C\u7684\u65F6\u5019\u6211\u4EEC\u9700\u8981\u5C06\u5C5E\u6027\u548C\u5BF9\u5E94\u7684effect\u5173\u8054\u8D77\u6765\r\n            return this.fn(); // \u51FA\u53D1\u5C5E\u6027\u7684get\r\n        } finally {\r\n            activeEffect = this.parent;\r\n            this.parent = undefined;\r\n        }\r\n    }\r\n}\r\n\r\nfunction effect(fn) {\r\n    // \u5C06\u7528\u6237\u7684\u51FD\u6570\uFF0C\u53D8\u6210\u4E00\u4E2A\u54CD\u5E94\u5F0F\u7684\u51FD\u6570\r\n    const _effect = new ReactiveEffect(fn);\r\n    // \u9ED8\u8BA4\u8BA9\u7528\u7528\u6237\u7684\u51FD\u6570\u6267\u884C\u4E00\u6B21\r\n    _effect.run();\r\n}\r\nexport { effect };\r\n", "export function isObject(val) {\r\n  return typeof val === \"object\" && val !== null;\r\n}\r\n", "import { activeEffect, effect } from \"./effect\";\r\nimport { ReactiveFlags } from \"./reactive\";\r\n\r\nexport const mutableHandlers = {\r\n    // \u539F\u59CB\u5BF9\u8C61 \u5C5E\u6027 \u4EE3\u7406\u5BF9\u8C61\r\n    get(target, key, recevier) {\r\n        if (key === ReactiveFlags[\"IS-REACTIVE\"]) {\r\n            return true;\r\n        }\r\n        track(target, key);\r\n        return Reflect.get(target, key, recevier);\r\n    },\r\n    set(target, key, value, recevier) {\r\n        let oldValue = target[key];\r\n        let flag = Reflect.set(target, key, value, recevier);\r\n\r\n        if (value !== oldValue) {\r\n            trigger(target, key, value, oldValue);\r\n        }\r\n        return flag;\r\n    },\r\n};\r\n// {\r\n//     name: \"jw\",\r\n//     age: 30,\r\n// } -> name => [effect1, effect2]\r\n\r\n// map = {data:map2} map2 = {name:set(effect1,effect2)}\r\nconst targetMap = new WeakMap();\r\n\r\nfunction track(target, key) {\r\n    if (activeEffect) {\r\n        // \u5F53\u524D\u5C5E\u6027\u5B9E\u5728effect\u4E2D\u4F7F\u7528\u7684\u624D\u4F1A\u6536\u96C6\uFF0C\u5426\u5219\u4E0D\u6536\u96C6\r\n        let depsMap = targetMap.get(target);\r\n        if (!depsMap) {\r\n            targetMap.set(target, (depsMap = new Map()));\r\n        }\r\n        let dep = depsMap.get(key);\r\n        if (!dep) {\r\n            depsMap.set(key, (dep = new Set()));\r\n        }\r\n        let shouldTrack = !dep.has(activeEffect);\r\n        if (shouldTrack) {\r\n            dep.add(activeEffect);\r\n            activeEffect.deps.push(dep);\r\n        }\r\n    }\r\n}\r\n\r\nfunction trigger(target, key, value, oldValue) {\r\n    // \u627E\u5230effect\u6267\u884C\u5373\u53EF\r\n    const depsMap = targetMap.get(target);\r\n    if (!depsMap) {\r\n        return;\r\n    }\r\n    const effects = depsMap.get(key);\r\n    if (effects) {\r\n        effects.forEach((effect) => {\r\n            // \u5F53\u524D\u6B63\u5728\u6267\u884C\u548C\u73B0\u5728\u8981\u6267\u884C\u7684\u662F\u540C\u4E00\u4E2A\u5C31\u5C4F\u853D\u6389\r\n            if (activeEffect !== effect) {\r\n                effect.run();\r\n            }\r\n        });\r\n    }\r\n}\r\n", "import { isObject } from \"@vue/shared\";\r\nimport { mutableHandlers } from \"./baseHandler\";\r\nexport const enum ReactiveFlags {\r\n    \"IS-REACTIVE\" = \"__v_isReactive\",\r\n}\r\n\r\nfunction reactive(target) {\r\n    return createRectiveObject(target);\r\n}\r\n\r\nconst reactiveMap = new WeakMap(); // \u9632\u6B62\u5185\u5B58\u6CC4\u6F0F\u7684\uFF0C\u7B2C\u4E00\u4E2A\u503C\u53EA\u80FD\u662F\u5BF9\u8C61\r\n\r\n// \u54CD\u5E94\u5F0F\u5BF9\u8C61\u7684\u6838\u5FC3\u903B\u8F91\r\n\r\nfunction createRectiveObject(target) {\r\n    if (!isObject(target)) {\r\n        return;\r\n    }\r\n\r\n    if (target[ReactiveFlags[\"IS-REACTIVE\"]]) {\r\n        return target;\r\n    }\r\n\r\n    // \u9632\u6B62\u540C\u4E00\u4E2A\u5BF9\u8C61\u88AB\u4EE3\u7406\u4E24\u6B21\uFF0C\u8FD4\u56DE\u7684\u6C38\u8FDC\u662F\u540C\u4E00\u4E2A\u5BF9\u8C61\r\n    let exitstingProxy = reactiveMap.get(target);\r\n    if (exitstingProxy) {\r\n        return exitstingProxy;\r\n    }\r\n    // \u8FD4\u56DE\u7684\u662F\u4EE3\u7406\u5BF9\u8C61\r\n    const proxy = new Proxy(target, mutableHandlers);\r\n    reactiveMap.set(target, proxy);\r\n    // \u4EE3\u7406\u524D\u4EE3\u7406\u540E\u505A\u4E00\u4E2A\u6620\u5C04\u8868\r\n    // \u5982\u679C\u7528\u540C\u4E00\u4E2A\u4EE3\u7406\u5BF9\u8C61\u505A\u4EE3\u7406\uFF0C\u76F4\u63A5\u8FD4\u56DE\u4E0A\u4E00\u6B21\u7684\u4EE3\u7406\u7ED3\u675F\r\n    // \u4EE3\u7406\u540E\u505A\u4E00\u4E2A\u6620\u5C04\u8868\r\n    return proxy;\r\n}\r\n\r\nexport { reactive };\r\n"],
  "mappings": ";AAAO,IAAI,eAAe;AAC1B,IAAM,iBAAN,MAAqB;AAAA,EAEjB,YAAmB,IAAI;AAAJ;AADnB,kBAAS;AAET,gBAAO,CAAC;AAAA,EADgB;AAAA;AAAA,EAExB,MAAM;AACF,QAAI;AACA,WAAK,SAAS;AACd,qBAAe;AAEf,aAAO,KAAK,GAAG;AAAA,IACnB,UAAE;AACE,qBAAe,KAAK;AACpB,WAAK,SAAS;AAAA,IAClB;AAAA,EACJ;AACJ;AAEA,SAAS,OAAO,IAAI;AAEhB,QAAM,UAAU,IAAI,eAAe,EAAE;AAErC,UAAQ,IAAI;AAChB;;;ACvBO,SAAS,SAAS,KAAK;AAC5B,SAAO,OAAO,QAAQ,YAAY,QAAQ;AAC5C;;;ACCO,IAAM,kBAAkB;AAAA;AAAA,EAE3B,IAAI,QAAQ,KAAK,UAAU;AACvB,QAAI,4CAAsC;AACtC,aAAO;AAAA,IACX;AACA,UAAM,QAAQ,GAAG;AACjB,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC5C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAC9B,QAAI,WAAW,OAAO,GAAG;AACzB,QAAI,OAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAEnD,QAAI,UAAU,UAAU;AACpB,cAAQ,QAAQ,KAAK,OAAO,QAAQ;AAAA,IACxC;AACA,WAAO;AAAA,EACX;AACJ;AAOA,IAAM,YAAY,oBAAI,QAAQ;AAE9B,SAAS,MAAM,QAAQ,KAAK;AACxB,MAAI,cAAc;AAEd,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAI,CAAC,SAAS;AACV,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC/C;AACA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,QAAI,CAAC,KAAK;AACN,cAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,IACtC;AACA,QAAI,cAAc,CAAC,IAAI,IAAI,YAAY;AACvC,QAAI,aAAa;AACb,UAAI,IAAI,YAAY;AACpB,mBAAa,KAAK,KAAK,GAAG;AAAA,IAC9B;AAAA,EACJ;AACJ;AAEA,SAAS,QAAQ,QAAQ,KAAK,OAAO,UAAU;AAE3C,QAAM,UAAU,UAAU,IAAI,MAAM;AACpC,MAAI,CAAC,SAAS;AACV;AAAA,EACJ;AACA,QAAM,UAAU,QAAQ,IAAI,GAAG;AAC/B,MAAI,SAAS;AACT,YAAQ,QAAQ,CAACA,YAAW;AAExB,UAAI,iBAAiBA,SAAQ;AACzB,QAAAA,QAAO,IAAI;AAAA,MACf;AAAA,IACJ,CAAC;AAAA,EACL;AACJ;;;AC9DO,IAAW,gBAAX,kBAAWC,mBAAX;AACH,EAAAA,eAAA,iBAAgB;AADF,SAAAA;AAAA,GAAA;AAIlB,SAAS,SAAS,QAAQ;AACtB,SAAO,oBAAoB,MAAM;AACrC;AAEA,IAAM,cAAc,oBAAI,QAAQ;AAIhC,SAAS,oBAAoB,QAAQ;AACjC,MAAI,CAAC,SAAS,MAAM,GAAG;AACnB;AAAA,EACJ;AAEA,MAAI,OAAO,kCAA4B,GAAG;AACtC,WAAO;AAAA,EACX;AAGA,MAAI,iBAAiB,YAAY,IAAI,MAAM;AAC3C,MAAI,gBAAgB;AAChB,WAAO;AAAA,EACX;AAEA,QAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAC/C,cAAY,IAAI,QAAQ,KAAK;AAI7B,SAAO;AACX;",
  "names": ["effect", "ReactiveFlags"]
}
